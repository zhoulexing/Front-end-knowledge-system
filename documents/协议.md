## TCP 为啥要 3 次握手和 4 次挥手？

图片见 images/TCP 三次握手，案例说只需要两次即可，但需要三次是因为客户端在向服务端发送第一次请求连接时，可能会因为网络等其他原因失效，
导致在后期服务端接收到请求。如果是两次握手的话，这种情况就会形成一次失效的连接，从而增加服务器开销。

图片见 images/TCP 四次挥手，四次是因为服务端在接收到客户端发送的关闭连接的消息时，可能还有数据未传完，所以服务端会先发送一个消息给
客户端，告诉它我知道了，然后把数据传输完，最后告诉客户端关闭连接，客户端收到消息就关闭连接。

如果是客户端突然挂掉了，为了处理这种情况，服务器会设置保活计时器，就发送探测报文段，若发送了 10 个探测报文段，每一个相隔 75 秒，还没有响应
就认为客户端出了故障，从而终止连接。

## 什么是 SYN 攻击？

攻击客户端在短时间内伪造大量不存在的 IP 进行访问，由于源地址是不存在的，所以服务端会不断的重发直至超时，这些伪造的 SYN 包将长时间占用未连接队列，
正常的 SYN 请求被丢弃，导致目标系统运行缓慢，严重者会引起网络堵塞，导致系统瘫痪。

## https 为什么安全？

因为 https 保证了传输的安全，防止传输过程被监听、防止数据被窃取、可以确认网络的安全性。

## https 的传输过程是怎样的？

客户端生成一个加密的随机数，加密方法如RSA公钥加密，然后向服务端发起请求；服务端也会生成一个加密随机数字，加密算法跟客户端一样，
然后将数字证书返回给客户端，客户端拿到数字证书后进行验证。验证过程包含以下几点：

1. 验证域名、有效期；
2. 判断证书来源是否合法；
3. 判断证书是否被篡改，需要与 CA 服务器进行校验；
4. 判断正式是否已被吊销。

验证不通过，就会向访问者显示一个警告，由其选择是否还要继续通信。验证通过的情况下，会在本地生成一个随机数，通过证书里的公钥加密，然后传给服务端；
服务端拿到加密后的随机数通过私钥进行解密拿到随机数；然后通过三个随机数双方商定加密方法，然后对数据进行加密传输给客户端，客户端拿到数据后利用本
地的随机数进行解密。

## 为什么一定要三个随机数？

三个随机数一同生成的秘钥不容易被猜出，一个伪随机数可能完全不随机，每增加一个自由度，随机性增加的可不是一。

## SSL/TLS 协议？

SSL 和 TLS 协议就是 HTTPS 协议相对 HTTP 协议多出来的加密的部分。

## 为什么需要证书？

防止中间人攻击。

## 针对HTTPS抓包流程？

1. 抓包工具捕获Client发送给Server请求，并伪装成客户端向服务端发起请求；
2. 服务端收到请求后，返回数字证书，并用根证书进行解密，获取到服务器的CA证书公钥。然后抓包工具伪造自己的CA证书，发送给客户端；
3. 客户端收到返回之后，和上面的流程一样，进行证书校验、然后利用抓包工具的公钥进行加密，生成协商密码，
4. 抓包工具捕获到Client发来的重要信息，通过私钥进行解密，获取到协商密码。然后使用服务器之前返回的公钥生成协商密码，并发送给服务器；
5. 服务器收到消息之后，通过私钥解密获取协商密码，对数据进行加密发送至抓包工具；
6. 抓包工具截获密文，并用协商密码进行解密，再用自己伪造证书的私钥进行加密传给客户端；
7. 客户端拿到加密信息后，用公钥解开，验证HASH，整个过程就完成了信任；
8. 在整个过程中，最重要的就是根证书，因为它伪造的CA证书是能获得双方信任的关键。

## nodejs 创建https server？
1. openssl genrsa -out key.pem
2. openssl req -new -key key.pem -out csr.pem
3. openssl x509 -req -days 9999 -in csr.pem -signkey key.pem -out cert.pem
4. rm csr.pem
